# 图形块基础功能说明
(ascii在线生成器:http://asciiflow.com/)

## 启用驱动
```python

import os

os.system("gnome-terminal -e 'bash ./LRSDK/DriveHAL/DriveHAL.sh'") 


# 图形块样式
+--+     +-------------------+
|  +-----+                   |
|      启动驱动               |
+--+      +------------------+
   +------+


```

## 车体模块
### 车体实例化
```python

# 车体模块依赖包引用
from LRSDK.application import Application

# 实例化车体模块
app = Application(fps=25, operate_mode="ManualDrive")
# fps为整数输入参数
# operate_mode为下拉框 默认:ManualDrive

# 图形块样式
+--+     +-----------------------------------------------+
|  +-----+                                               |
|      车体:fps ( 25 )   operate_mode: | ManualDrive |    |
|                                       | AutoDrive |    |
|                                       | AutoDrive_ui | |
+--+      +----------------------------------------------+
   +------+
```
### 车体方法
#### 车体运行
```python
# 车体模块运行方法
app.run(自定义方法名：例如procedure)

# 图形块样式
+--+     +---------------------+
|  +-----+                     |
|      车体.运行 (procedure)    |
+--+      +--------------------+
   +------+

```
#### 车体遥控器
```python
# 车体遥控器获取方法, 获取角度与速度指令 （返回值为2个小数值，范围 -1~1 ）
angle, throttle = app.get_joystick_info()

# 图形块样式
    +-------------------------+
    |                         |
+---+                         |
|          车体.遥控器指令     |
+---+                         |
    |                         |
    +-------------------------+

```

#### 车体摄像头
```python
# 设置启用名为wideAngle的摄像头, 也就是车上的冲下方的广角摄像头
app.setup_camera(dev_name="/dev/wideAngle")

# 图形块样式
+--+     +-----------------------------------+
|  +-----+                                   |
|      车体.摄像头配置地址: (/dev/wideAngle)  |
+--+      +----------------------------------+
   +------+

# 获取广角摄像头图像
frame_wide_drive = app.get_image(dev_name="/dev/wideAngle")
 
# 图形块样式
    +----------------------------------------------+
    |                                              |
+---+                                              |
|          车体.获取摄像头地址: (/dev/wideAngle)    |
+---+                                              |
    |                                              |
    +----------------------------------------------+
 
# 截取摄像头图像区域,起始坐标为(0, 0), 终止坐标为(640, 380)
frame_wide_drive = app.cut_active_area(frame_wide_drive, coordinate_start=(0, 0), coordinate_end=(640, 380), padding=False)
# 图形块样式
    +------------------------------------------------+
    |                                                |
+---+                                                |
|          车体.摄像头剪切: 起始(0, 0) 终止(640, 380)  |
+---+                                                |
    |                                                |
    +------------------------------------------------+
    
# 说明：
+-------------------------------------------+
|                                           |
|        起始（x,y）                         |
|        +---------------------+            |
|        |                     |            |
|        |                     |            |
|        |                     |            |
|        |                     |            |
|        |                     |            |
|        |                     |            |
|        |                     |            |
|        +---------------------+            |
|                              终止(x,y)     |
|                                           |
|                                           |
|                                           |
+-------------------------------------------+

# 改变图像大小为(224, 224)
frame_wide_drive = app.resize(frame_wide_drive, (224, 224))
# 图形块样式
    +--------------------------------------+
    |                                      |
+---+                                      |
|          车体.摄像头缩放: (224, 224)      |
+---+                                      |
    |                                      |
    +--------------------------------------+


# 显示图像
app.show_image(window_name="frame_wide", frame=frame_wide_drive, show_fps=True)

# 图形块样式
+--+     +----------------------+
|  +-----+                      |
|      车体.摄像头显示           |
+--+      +---------------------+
   +------+

# 发送图像到网页服务
app.web_video_broadcast(frame_list=[frame_wide_drive])
# frame_list 为一个数组列表
# [frame_wide_drive] 为数组有一个元素的情况，最多两个， frame_wide_drive为 numpy array类型

# 图形块样式
+--+     +-------------------------------+
|  +-----+                               |
|      车体.网页广播(frame_wide_drive)    |
+--+      +------------------------------+
   +------+

```


## 控制模块
### 控制实例化
```python

# 控制模块依赖包引用
from LRSDK.appController import AppController

# 实例化控制模块
control = AppController()

# 图形块样式
+--+     +---------------------+
|  +-----+                     |
|      控制模块                 |
+--+      +--------------------+
   +------+
```
### 控制方法
```python
# 控制 运动方法
control.angle = 0.5 #左拐
control.throttle  = 0.1 #向前速度为0.1

# 下拉框选项为：
# Angle 为小车转向角度
# Throttle 为小车速度
# 角度和速度的值为1~-1之间，可根据需求映射为角度0~180度，速度255~-255之间


# 图形块样式
+--+     +------------------------------+
|  +-----+                              |
|      控制: 方式: | angle |   值（0.5） |
|                  | throttle |         |
+--+      +-----------------------------+
   +------+

```
### 控制返回
```python
# 返回 控制实例
return control

# 图形块样式
    +-------------------------+
    |                         |
+---+                         |
|          控制                |
+---+                         |
    |                         |
    +-------------------------+


```

## 自定义功能
```python
# 定义用户实现逻辑
def procedure():
	xxxxxx
   return control

# 图形块样式
+-----------------------------------------------+
|                                               |
|     (自定义函数名 比如:procedure)              |
|                                               |
|        +--------------------------------------+
|        |
|        |
|        |
|        |
|        |
|        +--------------------------------------+
|                                               |
|                                               |
|                                               |
+-----------------------------------------------+


```

## 数据存储模块
### 数据存储实例化

```python
# 调用数据存储模块
from LRSDK.dataStore import DataStore

# 实例化数据存储模块,设置存储路径
data_store = DataStore(data_folder="./data")

# 图形块样式
+--+     +------------------------+
|  +-----+                        |
|      数据模块 存储地址:(./data)  |
+--+      +-----------------------+
   +------+


```

### 数据存储方法
```python
# 将当前图像和对应的指令标签存贮到指定目录用于后续训练(一张图片对应一个标签)
data_store.save(frame_wide_drive, angle, throttle)
# frame_wide_drive 处理后的采集图片，类型为 numpy array
# angle 遥控器针对此图片的角度, 类型为小数(-1~1)
# throttle 遥控器针对此图片的速度, 类型为小数(-1~1)

# 图形块样式
+--+     +-------------------------------------------+
|  +-----+                                           |
|      数据.保存（frame_wide_drive, angle, throttle） |
+--+      +------------------------------------------+
   +------+

```


## 模型推理模块
### 模型推理实例化

```python
# 引用自动驾驶模型模块
from baseModels.KerasBaseModel import DriveModel

# 指定模型路径
model_path = './output/default_2019_05_10_los012.h5'

# 实例化自动驾驶模块, 指定模型路径
drive_model = DriveModel(model_path=model_path)

# 图形块样式
+--+     +-------------------------------------------------------+
|  +-----+                                                       |
|      推理模块 模型地址:(./output/default_2019_05_10_los012.h5)  |
+--+      +------------------------------------------------------+
   +------+


```

### 模型推理方法

```python

# 模型推理，并获取预测角度和速度
angle, throttle = drive_model.predict_image(frame_wide_drive)
# frame_wide_drive 为摄像头获取的图像

# 图形块样式
    +-----------------------------------+
    |                                   |
+---+                                   |
|          模型.预测(frame_wide_drive)   |
+---+                                   |
    |                                   |
    +-----------------------------------+


```
